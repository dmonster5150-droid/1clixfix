const admin = require("firebase-admin");
async function init(){ if(admin.apps && admin.apps.length) return; const b64 = process.env.FIREBASE_SERVICE_ACCOUNT_BASE64||""; if(!b64) throw new Error("Missing FIREBASE_SERVICE_ACCOUNT_BASE64"); const svc = JSON.parse(Buffer.from(b64,"base64").toString("utf8")); admin.initializeApp({ credential: admin.credential.cert(svc) }); }
exports.handler = async function(event){ try{ await init(); const providerId = (event.queryStringParameters && event.queryStringParameters.providerId) || ""; if(!providerId) return { statusCode:400, body: JSON.stringify({ error: "missing providerId" }) }; const db = require('firebase-admin').firestore(); const doc = await db.collection('providers').doc(providerId).get(); if(!doc.exists) return { statusCode:404, body: JSON.stringify({ error: "not found" }) }; return { statusCode:200, body: JSON.stringify({ exists:true, data: doc.data() }) }; }catch(e){ console.error(e); return { statusCode:500, body: JSON.stringify({ error: e.message||e }) }; } }