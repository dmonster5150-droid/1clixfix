const admin = require("firebase-admin");
async function init(){ if(admin.apps && admin.apps.length) return; const b64 = process.env.FIREBASE_SERVICE_ACCOUNT_BASE64||""; if(!b64) throw new Error("Missing FIREBASE_SERVICE_ACCOUNT_BASE64"); const svc = JSON.parse(Buffer.from(b64,"base64").toString("utf8")); admin.initializeApp({ credential: admin.credential.cert(svc) }); }
exports.handler = async function(){ try{ await init(); const db = require('firebase-admin').firestore(); const snap = await db.collection('jobs').where('status','==','open').orderBy('date','asc').get(); const jobs = snap.docs.map(d=>({ id:d.id, ...d.data() })); return { statusCode:200, body: JSON.stringify({ jobs }) }; }catch(e){ console.error(e); return { statusCode:500, body: JSON.stringify({ error: e.message||e }) }; } }